const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DjMKCwpZ.js","assets/vendor-D-Jip_Ib.js","assets/index-DTvXUW76.css","assets/skillValidator-BcnBOhtX.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./index-DjMKCwpZ.js";import{r as g}from"./vendor-D-Jip_Ib.js";const O="moblyze_job_enhancements";function A(){try{const t=localStorage.getItem(O);return t?JSON.parse(t):{}}catch(t){return console.error("Failed to load job enhancements from localStorage:",t),{}}}function G(t,e){try{const o=A();return o[t]=e,localStorage.setItem(O,JSON.stringify(o)),!0}catch(o){return console.error("Failed to save job enhancement to localStorage:",o),!1}}function V(t){const e=A();return Object.keys(e).length===0?t:t.map(o=>{const s=e[o.id];return s?{...o,structuredDescription:s,_clientEnhanced:!0}:o})}const S="jobs_last_updated",N=()=>u(()=>import("./geocoder-DzgUVvMR.js"),[]);function M(){const[t,e]=g.useState([]),[o,s]=g.useState(!0),[i,r]=g.useState(null),[a,n]=g.useState(null),[c,L]=g.useState(()=>{const l=localStorage.getItem(S);return l?new Date(l):null}),d=g.useCallback(async(l=!1)=>{s(!0),r(null),n(null);const j=l?`/internal-jobs-review/data/jobs.json?t=${Date.now()}`:"/internal-jobs-review/data/jobs.json";l&&console.log("[useJobs] Force refresh requested - fetching with cache-busting");try{const f=await fetch(j,{cache:l?"no-store":"default"});if(!f.ok)throw new Error("Failed to load jobs");const p=await f.json(),b=new Date;console.log(`[useJobs] Successfully loaded ${p.length} jobs`),console.log("[useJobs] First job sample:",p[0]);const v=V(p);if(console.log("[useJobs] Merged client-side enhancements"),e(v),L(b),localStorage.setItem(S,b.toISOString()),s(!1),console.log("[useJobs] Loading state set to false, jobs set"),l){console.log("[useJobs] Checking for new locations to geocode...");try{const{checkForNewLocations:y,geocodeNewLocations:T}=await N(),w=await y(p);if(w.hasNewLocations){console.log(`[useJobs] Found ${w.newLocationCount} new locations to geocode`),n({type:"geocoding",count:w.newLocationCount});const E=await T(p,(D,J,P)=>{n({type:"geocoding",current:D,total:J,location:P})});n({type:"success",message:E.message,newLocations:E.newLocations,failed:E.failed}),setTimeout(()=>n(null),5e3)}else console.log("[useJobs] All locations already geocoded")}catch(y){console.warn("[useJobs] Geocoding error (non-fatal):",y.message),n({type:"error",message:"Geocoding failed (dev mode only)"}),setTimeout(()=>n(null),5e3)}}}catch(f){console.error("[useJobs] Error loading jobs:",f),r(f.message),s(!1)}},[]);g.useEffect(()=>{d()},[d]);const _=g.useCallback(()=>{console.log("[useJobs] Refresh button clicked"),d(!0)},[d]);return{jobs:t,loading:o,error:i,lastUpdated:c,refresh:_,geocodingStatus:a}}function $(t,e){return t.find(o=>o.id===e)}function z(t,e){return e.replace(/-/g," "),t.filter(o=>o.company.toLowerCase().replace(/\s+/g,"-")===e)}async function U(t,e,o=5){if(!e)return[];const s=t.filter(n=>n.id!==e.id&&n.company===e.company);if(s.length>=o)return s.slice(0,o);const{getAllLocations:i}=await u(async()=>{const{getAllLocations:n}=await import("./locationParser-bB2ba_O7.js");return{getAllLocations:n}},[]),r=i(e.location),a=t.filter(n=>n.id!==e.id&&n.company!==e.company).map(n=>{let c=0;i(n.location).some(l=>r.includes(l))&&(c+=2);const _=n.skills.filter(l=>e.skills.includes(l));return c+=_.length,{job:n,score:c}}).filter(({score:n})=>n>0).sort((n,c)=>c.score-n.score).map(({job:n})=>n);return[...s,...a].slice(0,o)}function Y(t){return[...new Set(t.map(o=>o.company))].sort()}async function q(t){const{getAllLocations:e}=await u(async()=>{const{getAllLocations:i}=await import("./locationParser-bB2ba_O7.js");return{getAllLocations:i}},[]),o=t.map(i=>e(i.location)).filter(i=>i.length>0);return[...new Set(o.flat())].sort()}async function B(t){const{initializeONet:e}=await u(async()=>{const{initializeONet:a}=await import("./index-DjMKCwpZ.js").then(n=>n.o);return{initializeONet:a}},__vite__mapDeps([0,1,2]));await e();const{filterValidSkills:o}=await u(async()=>{const{filterValidSkills:a}=await import("./skillValidator-BcnBOhtX.js");return{filterValidSkills:a}},__vite__mapDeps([3,0,1,2])),s=t.flatMap(a=>a.skills),i=o(s);return[...new Set(i)].sort()}async function H(t){const{getAllCertificationsWithCounts:e}=await u(async()=>{const{getAllCertificationsWithCounts:o}=await import("./certificationExtractor-Dsducp3z.js");return{getAllCertificationsWithCounts:o}},[]);return e(t)}function W(t,e=5){const o={};return t.forEach(s=>{s.company&&(o[s.company]=(o[s.company]||0)+1)}),Object.entries(o).sort((s,i)=>i[1]-s[1]).slice(0,e).map(([s])=>s)}async function K(t,e=5){const{getAllLocations:o}=await u(async()=>{const{getAllLocations:i}=await import("./locationParser-bB2ba_O7.js");return{getAllLocations:i}},[]),s={};return t.forEach(i=>{o(i.location).forEach(a=>{s[a]=(s[a]||0)+1})}),Object.entries(s).sort((i,r)=>r[1]-i[1]).slice(0,e).map(([i])=>i)}async function Q(t,e=5){const{initializeONet:o}=await u(async()=>{const{initializeONet:r}=await import("./index-DjMKCwpZ.js").then(a=>a.o);return{initializeONet:r}},__vite__mapDeps([0,1,2]));await o();const{filterValidSkills:s}=await u(async()=>{const{filterValidSkills:r}=await import("./skillValidator-BcnBOhtX.js");return{filterValidSkills:r}},__vite__mapDeps([3,0,1,2])),i={};return t.forEach(r=>{s(r.skills).forEach(n=>{i[n]=(i[n]||0)+1})}),Object.entries(i).sort((r,a)=>a[1]-r[1]).slice(0,e).map(([r])=>r)}let h=null,m=null;async function k(){return h||m||(m=(async()=>{try{const t=await fetch("/internal-jobs-review/data/job-occupations.json");if(!t.ok)return console.warn("Occupation mappings file not found. Run: npm run match-occupations"),{};const e=await t.json();return h=e,console.log(`âœ… Loaded ${Object.keys(e).length} job-to-occupation mappings`),e}catch(t){return console.warn("Failed to load occupation mappings:",t),{}}})(),m)}async function X(t){const{getEnergyRole:e,ENERGY_ROLES:o}=await u(async()=>{const{getEnergyRole:r,ENERGY_ROLES:a}=await import("./energyRoles-CCaplMj4.js");return{getEnergyRole:r,ENERGY_ROLES:a}},[]),s=await k(),i={};return t.forEach(r=>{const a=s[r.id];if(!a)return;let n;a.role_id?n={id:a.role_id,...o[a.role_id]}:n=e(a.onet_code),i[n.id]=(i[n.id]||0)+1}),Object.entries(i).map(([r,a])=>({id:r,label:o[r].label,count:a,icon:o[r].icon,category:o[r].category})).sort((r,a)=>r.id==="other"?1:a.id==="other"?-1:a.count-r.count)}async function Z(t,e){if(!e||Array.isArray(e)&&e.length===0)return t;const{getEnergyRole:o,ENERGY_ROLES:s}=await u(async()=>{const{getEnergyRole:a,ENERGY_ROLES:n}=await import("./energyRoles-CCaplMj4.js");return{getEnergyRole:a,ENERGY_ROLES:n}},[]),i=await k(),r=Array.isArray(e)?e:[e];return t.filter(a=>{const n=i[a.id];if(!n)return!1;let c;return n.role_id?c={id:n.role_id,...s[n.role_id]}:c=o(n.onet_code),r.includes(c.id)})}function R(t){if(!t||typeof t!="string")return"";let o=new DOMParser().parseFromString(t,"text/html").body.textContent||"";return o=o.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).join(`
`),o}function C(t){return!t||typeof t!="string"?!1:/<\/?[a-z][\s\S]*>/i.test(t)}function x(t){return!t||typeof t!="string"?"":C(t)?(console.warn("HTML detected in job description, cleaning...",t.substring(0,100)),R(t)):t}function tt(t){if(!t||typeof t!="string")return"";if(!C(t))return t;let e=t.replace(/<br\s*\/?>/gi,`
`);return e=e.replace(/<\/(p|div|h[1-6]|li|tr)>/gi,`
`),e=R(e),e}export{Q as a,K as b,Y as c,q as d,B as e,H as f,W as g,X as h,Z as i,tt as j,U as k,x as l,z as m,$ as n,G as s,M as u};
